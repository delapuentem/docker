## Docker compose healthcheck

### Comprobar la salud de un contenedor con healthcheck 
```yaml
services:
  mongo:
    image: mongo
    container_name: mongo
    restart: always
    ports:
      - 27017:27017
    environment:
      MONGO_INITDB_ROOT_USERNAME: admin
      MONGO_INITDB_ROOT_PASSWORD: admin12345
    healthcheck:
      test: ["CMD-SHELL", "mongosh --eval 'db.runCommand({ ping: 1 })' || exit 1"]
      interval: 10s
      timeout: 5s
      retries: 5
      start_period: 10s
```

Para un mongo o un apache la comprobacion seria diferente
```yaml
services:
  apache:
    image: httpd
    ports:
      - "9090:80"
    volumes:
      - ./html:/usr/local/apache2/htdocs
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 10s
```

###  Inspeccionar el estado en detalle
```bash
docker inspect mongo --format='{{json .State.Health}}'
```

Para ver los mensajes de salida de los healthcheck realizados (por ejemplo, el resultado de curl, nc, etc).
```bash
docker inspect mongo --format='{{range .State.Health.Log}}{{.Output}}{{end}}'
```