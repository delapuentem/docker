## Docker compose

### Creamos un directorio con el nombre del proyecto
Docker compose usa el concepto de proyecto, asi que va a usar por defecto el nombre del directorio
```bash
mkdir influxdata
```

### Creamos el fichero docker compose dentro del directorio
```bash
vim docker-compose.yml
```
```yaml
services:
  grafana:
    image: "grafana/grafana:12.2.0-16787028595-ubuntu"
    container_name: "grafana"
    ports:
    - "80:3000"
    restart: always
    logging:
      driver: "json-file"
      options:
        max-size: "100mb"
        max-file: "5"
    networks:
      - influxdata

networks:
  influxdata:
    driver: bridge
```

**IMPORTANTE !!!** Los siguientes comandos de docker compose SOLO se pueden ejecutar desde la carpeta del proyecto.

Ya que si hago un `docker compose ps -a`, o un `docker compose stop` esto afectara a los contenedores del proyecto en el que esté situado.

### Ejecutar comandos de compose desde cualquier sitio
```bash
docker compose -p mongodb ps -a
```
- **-p** es proyecto, el proyecto es el nombre de la carpeta donde tengo el compose.

### Ejecutar docker compose
```bash
docker compose up -d  (-d para ponerlo en modo backgroud)
```
Ejecutarlo desde dentro de la carpeta del proyecto

Por defecto docker compose nos va a crear una red bridge propia para todos los contenedores que cree a partir del docker-compose.yml para que esten 
en la misma red.


### Listar proyectos corriendo de docker compose
```bash
docker compose ls
```


### Listar contenedores desde un modo de vista de compose
```bash
docker compose ps -a
```


### Parar y arrancar todos los servicios
```bash
docker compose start
docker compose stop
```


### Eliminar todo, servicios contenedores interfaces de red, networks....
```bash
docker compose down 
docker compose down --volumes --remove-orphans
```

- **--volumes** También borra los volúmenes definidos en docker-compose.yml
- **--remove-orphans** Elimina contenedores huérfanos (los que ya no están listados en el YAML)


### Visualizar imagenes asociadas a contenedores
```bash
docker compose images 
```


### Visualizar los logs de los contenedores
```bash
docker compose logs 
docker compose logs grafana
```


### Ver que procesos son mas pesados
```bash
docker compose top
docker compose top grafana
```

### Arrancar solo un servicio
```bash
docker compose up -d influxdb
```
Puedo modificar el fichero docker compose y levantar solo este servicio despues de eliminarlo

### Eliminar solo un servicio
```bash
docker compose rm infludb
```
